<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Gestión de Productos</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f4f7fa;
      margin: 0;
      padding: 20px;
      color: #333;
      font-size: 18px;
      line-height: 1.6;
      -webkit-text-size-adjust: 100%;
      -moz-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    .contenedor {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }
    h2, h3 {
      color: #0d47a1;
      margin-bottom: 15px;
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 14px 16px;
      margin-top: 6px;
      margin-bottom: 18px;
      border: 1.5px solid #ccc;
      border-radius: 8px;
      font-size: 18px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
      touch-action: manipulation;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 5px rgba(25, 118, 210, 0.5);
    }
    button {
      background-color: #1976d2;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      font-size: 20px;
      border-radius: 8px;
      transition: background 0.3s ease;
      padding: 14px 0;
      user-select: none;
    }
    button:hover, button:focus {
      background-color: #1565c0;
    }
    .acciones button {
      background-color: #f44336;
      font-size: 18px;
      padding: 10px 16px;
      width: auto;
      user-select: none;
    }
    .acciones button:hover, .acciones button:focus {
      background-color: #d32f2f;
    }
    .editar-btn {
      background-color: #ffa000;
      margin-right: 10px;
    }
    .editar-btn:hover, .editar-btn:focus {
      background-color: #ff8f00;
    }
    .form-section, .salida-form, .filtros-section {
      background: #e8f0fe;
      padding: 25px 30px;
      margin-bottom: 30px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.07);
    }
    .subetiqueta {
      display: none;
    }
    ul {
      padding: 0;
      list-style-type: none;
    }
    li.producto {
      background: #fafafa;
      padding: 20px 25px;
      margin-bottom: 18px;
      border-left: 8px solid #1976d2;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      font-size: 18px;
      line-height: 1.5;
      word-wrap: break-word;
    }
    .acciones {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    .salida-form {
      margin-top: 18px;
      background: #dbeeff;
      padding: 18px 22px;
      border-left: 6px solid #42a5f5;
      border-radius: 8px;
    }
    em {
      display: block;
      margin-top: 12px;
      color: #388e3c;
      font-style: normal;
      font-weight: bold;
    }

    /* Responsive para pantallas pequeñas */
    @media (max-width: 600px) {
      body {
        padding: 15px 10px;
        font-size: 18px;
      }

      .contenedor {
        padding: 15px 15px;
        margin: 0 10px;
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      select,
      textarea {
        font-size: 18px;
        padding: 12px 14px;
      }

      button {
        font-size: 18px;
        padding: 12px 0;
      }

      li.producto {
        padding: 18px 15px;
        font-size: 18px;
      }

      .acciones {
        flex-direction: column;
      }

      .acciones button {
        width: 100%;
        margin-bottom: 10px;
        font-size: 18px;
        padding: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <h2>📦 Registro de Producto</h2>

    <div class="form-section">
      <input type="hidden" id="edit-id" />
      
      <label for="producto">Nombre del Producto:</label>
      <input type="text" id="producto" autocomplete="off" />

      <label for="palets">Cantidad de Palets:</label>
      <input type="number" id="palets" min="1" />

      <label for="observacion">Observación:</label>
      <textarea id="observacion" rows="3" autocomplete="off"></textarea>

      <label for="origen">Origen del Palet:</label>
      <select id="origen">
        <option value="">Selecciona origen</option>
        <option value="BARCELONA">BARCELONA</option>
        <option value="ISLA PALMA">ISLA PALMA</option>
        <option value="MENORCA">MENORCA</option>
        <option value="IBIZA">IBIZA</option>
      </select>

      <label for="etiqueta">Etiqueta (Destino):</label>
      <select id="etiqueta">
        <option value="">Selecciona una etiqueta</option>
        <option value="Isla Palma">Isla Palma</option>
        <option value="Menorca">Menorca</option>
        <option value="Ibiza">Ibiza</option>
        <option value="Barcelona">Barcelona</option>
      </select>

      <div id="subetiqueta-container" class="subetiqueta">
        <label for="subetiqueta">Subetiqueta de Isla Palma:</label>
        <select id="subetiqueta">
          <option value="">Selecciona una subetiqueta</option>
          <option value="Roger Palma">Roger Palma</option>
          <option value="Ticsa Palma">Ticsa Palma</option>
          <option value="Solo Isla Palma">Solo Isla Palma</option>
        </select>
      </div>

      <button onclick="guardarProducto()">💾 Guardar Producto</button>
      <button onclick="mostrarProductos()">📅 Ver Productos</button>
    </div>

    <div class="filtros-section">
      <h3>🔎 Filtros de productos</h3>
      <label for="filtro-fecha">Filtrar por Fecha de Ingreso:</label>
      <input type="date" id="filtro-fecha" />

      <label for="filtro-origen">Filtrar por Origen:</label>
      <select id="filtro-origen">
        <option value="">Todos</option>
        <option value="BARCELONA">BARCELONA</option>
        <option value="ISLA PALMA">ISLA PALMA</option>
        <option value="MENORCA">MENORCA</option>
        <option value="IBIZA">IBIZA</option>
      </select>

      <label for="filtro-etiqueta">Filtrar por Etiqueta (Destino):</label>
      <select id="filtro-etiqueta">
        <option value="">Todos</option>
        <option value="Isla Palma">Isla Palma</option>
        <option value="Menorca">Menorca</option>
        <option value="Ibiza">Ibiza</option>
        <option value="Barcelona">Barcelona</option>
      </select>

      <label for="filtro-subetiqueta" style="display:none;">Filtrar por Subetiqueta Isla Palma:</label>
      <select id="filtro-subetiqueta" style="display:none;">
        <option value="">Todos</option>
        <option value="Roger Palma">Roger Palma</option>
        <option value="Ticsa Palma">Ticsa Palma</option>
        <option value="Solo Isla Palma">Solo Isla Palma</option>
      </select>

      <button onclick="aplicarFiltros()">Aplicar filtros</button>
      <button onclick="limpiarFiltros()">Limpiar filtros</button>
    </div>

    <h3>🧾 Productos</h3>
    <ul id="lista-productos"></ul>
  </div>

  <script>
    const etiquetaSelect = document.getElementById("etiqueta");
    const subetiquetaContainer = document.getElementById("subetiqueta-container");
    const filtroEtiqueta = document.getElementById("filtro-etiqueta");
    const filtroSubetiqueta = document.getElementById("filtro-subetiqueta");

    etiquetaSelect.addEventListener("change", () => {
      subetiquetaContainer.style.display = etiquetaSelect.value === "Isla Palma" ? "block" : "none";
    });

    filtroEtiqueta.addEventListener("change", () => {
      const labelSubetiqueta = filtroSubetiqueta.previousElementSibling;
      if (filtroEtiqueta.value === "Isla Palma") {
        filtroSubetiqueta.style.display = "block";
        if(labelSubetiqueta) labelSubetiqueta.style.display = "block";
      } else {
        filtroSubetiqueta.style.display = "none";
        if(labelSubetiqueta) labelSubetiqueta.style.display = "none";
        filtroSubetiqueta.value = "";
      }
    });

    function guardarProducto() {
      const idEdit = document.getElementById("edit-id").value;
      const producto = document.getElementById("producto").value.trim();
      const palets = document.getElementById("palets").value.trim();
      const observacion = document.getElementById("observacion").value.trim();
      const origen = document.getElementById("origen").value;
      const etiqueta = etiquetaSelect.value;
      const subetiqueta = document.getElementById("subetiqueta").value;
      if (!producto || !palets || !origen || !etiqueta) {
        alert("Por favor completa todos los campos obligatorios.");
        return;
      }
      let productos = JSON.parse(localStorage.getItem("productos")) || [];

      if (idEdit) {
        productos = productos.map(p => {
          if (p.id === idEdit) {
            return {
              ...p,
              producto,
              palets: Number(palets),
              observacion,
              origen,
              etiqueta,
              subetiqueta: etiqueta === "Isla Palma" ? subetiqueta : "",
              fechaIngreso: new Date().toISOString(),
            };
          }
          return p;
        });
      } else {
        productos.push({
          id: Date.now().toString(),
          producto,
          palets: Number(palets),
          observacion,
          origen,
          etiqueta,
          subetiqueta: etiqueta === "Isla Palma" ? subetiqueta : "",
          fechaIngreso: new Date().toISOString(),
        });
      }

      localStorage.setItem("productos", JSON.stringify(productos));
      limpiarFormulario();
      mostrarProductos();
    }

    function limpiarFormulario() {
      document.getElementById("edit-id").value = "";
      document.getElementById("producto").value = "";
      document.getElementById("palets").value = "";
      document.getElementById("observacion").value = "";
      document.getElementById("origen").value = "";
      etiquetaSelect.value = "";
      document.getElementById("subetiqueta").value = "";
      subetiquetaContainer.style.display = "none";
    }

    function mostrarProductos(productosFiltrados) {
      let productos = productosFiltrados || JSON.parse(localStorage.getItem("productos")) || [];
      productos.sort((a,b) => new Date(b.fechaIngreso) - new Date(a.fechaIngreso));

      const lista = document.getElementById("lista-productos");
      lista.innerHTML = "";

      if (productos.length === 0) {
        lista.innerHTML = "<li>No hay productos registrados.</li>";
        return;
      }

      productos.forEach(p => {
        const li = document.createElement("li");
        li.classList.add("producto");

        let destinoCompleto = p.etiqueta;
        if (p.etiqueta === "Isla Palma" && p.subetiqueta && p.subetiqueta !== "Solo Isla Palma") {
          destinoCompleto += " - " + p.subetiqueta;
        }

        const fechaFormat = new Date(p.fechaIngreso).toLocaleString("es-ES");

        li.innerHTML = `
          <strong>Producto:</strong> ${p.producto} <br />
          <strong>Palets:</strong> ${p.palets} <br />
          <strong>Observación:</strong> ${p.observacion || "Ninguna"}<br />
          <strong>Origen:</strong> ${p.origen}<br />
          <strong>Destino (Etiqueta):</strong> ${destinoCompleto}<br />
          <strong>Fecha Ingreso:</strong> ${fechaFormat}
          <div class="acciones">
            <button class="editar-btn" onclick="editarProducto('${p.id}')">✏️ Editar</button>
            <button onclick="eliminarProducto('${p.id}')">🗑️ Eliminar</button>
          </div>
        `;
        lista.appendChild(li);
      });
    }

    function editarProducto(id) {
      const productos = JSON.parse(localStorage.getItem("productos")) || [];
      const producto = productos.find(p => p.id === id);
      if (!producto) return;

      document.getElementById("edit-id").value = producto.id;
      document.getElementById("producto").value = producto.producto;
      document.getElementById("palets").value = producto.palets;
      document.getElementById("observacion").value = producto.observacion;
      document.getElementById("origen").value = producto.origen;
      etiquetaSelect.value = producto.etiqueta;

      if (producto.etiqueta === "Isla Palma") {
        subetiquetaContainer.style.display = "block";
        document.getElementById("subetiqueta").value = producto.subetiqueta || "";
      } else {
        subetiquetaContainer.style.display = "none";
        document.getElementById("subetiqueta").value = "";
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function eliminarProducto(id) {
      if (!confirm("¿Seguro que quieres eliminar este producto?")) return;
      let productos = JSON.parse(localStorage.getItem("productos")) || [];
      productos = productos.filter(p => p.id !== id);
      localStorage.setItem("productos", JSON.stringify(productos));
      mostrarProductos();
    }

    function aplicarFiltros() {
      const filtroFecha = document.getElementById("filtro-fecha").value;
      const filtroOrigen = document.getElementById("filtro-origen").value;
      const filtroEtiquetaVal = filtroEtiqueta.value;
      const filtroSubetiquetaVal = filtroSubetiqueta.value;

      let productos = JSON.parse(localStorage.getItem("productos")) || [];

      if (filtroFecha) {
        productos = productos.filter(p => p.fechaIngreso.startsWith(filtroFecha));
      }
      if (filtroOrigen) {
        productos = productos.filter(p => p.origen === filtroOrigen);
      }
      if (filtroEtiquetaVal) {
        productos = productos.filter(p => p.etiqueta === filtroEtiquetaVal);
      }
      if (filtroEtiquetaVal === "Isla Palma" && filtroSubetiquetaVal) {
        productos = productos.filter(p => p.subetiqueta === filtroSubetiquetaVal);
      }

      mostrarProductos(productos);
    }

    function limpiarFiltros() {
      document.getElementById("filtro-fecha").value = "";
      document.getElementById("filtro-origen").value = "";
      filtroEtiqueta.value = "";
      filtroSubetiqueta.value = "";
      filtroSubetiqueta.style.display = "none";
      if(filtroSubetiqueta.previousElementSibling) filtroSubetiqueta.previousElementSibling.style.display = "none";
      mostrarProductos();
    }

    // Mostrar productos al cargar
    mostrarProductos();
  </script>
</body>
</html>
