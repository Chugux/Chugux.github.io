<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestión de Productos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f4f7fa;
      margin: 0;
      padding: 20px;
      color: #333;
      font-size: 18px;
      line-height: 1.6;
    }
    .contenedor {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }
    h2, h3 {
      color: #0d47a1;
      margin-bottom: 15px;
      text-align: center;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 14px 16px;
      margin-top: 6px;
      margin-bottom: 18px;
      border: 1.5px solid #ccc;
      border-radius: 8px;
      font-size: 18px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 5px rgba(25, 118, 210, 0.5);
    }
    button {
      background-color: #1976d2;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      font-size: 20px;
      border-radius: 8px;
      transition: background 0.3s ease;
      padding: 14px 0;
    }
    button:hover {
      background-color: #1565c0;
    }
    .acciones button {
      background-color: #f44336;
      font-size: 18px;
      padding: 10px 16px;
      width: auto;
    }
    .acciones button:hover {
      background-color: #d32f2f;
    }
    .editar-btn {
      background-color: #ffa000;
      margin-right: 10px;
    }
    .editar-btn:hover {
      background-color: #ff8f00;
    }
    .form-section, .salida-form, .filtros-section {
      background: #e8f0fe;
      padding: 25px 30px;
      margin-bottom: 30px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.07);
    }
    .subetiqueta {
      display: none;
    }
    ul {
      padding: 0;
      list-style-type: none;
    }
    li.producto {
      background: #fafafa;
      padding: 20px 25px;
      margin-bottom: 18px;
      border-left: 8px solid #1976d2;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
      font-size: 18px;
      line-height: 1.5;
      word-wrap: break-word;
    }
    .acciones {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .salida-form {
      margin-top: 18px;
      background: #dbeeff;
      padding: 18px 22px;
      border-left: 6px solid #42a5f5;
      border-radius: 8px;
    }
    em {
      display: block;
      margin-top: 12px;
      color: #388e3c;
      font-style: normal;
      font-weight: bold;
    }

    /* Responsive para pantallas pequeñas */
    @media (max-width: 600px) {
      body {
        padding: 20px 15px;
        font-size: 20px;
      }

      .contenedor {
        padding: 20px 15px;
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      select,
      textarea {
        font-size: 20px;
        padding: 16px 20px;
      }

      button {
        font-size: 20px;
        padding: 16px 0;
      }

      li.producto {
        padding: 25px 20px;
        font-size: 20px;
        word-wrap: break-word;
      }

      .acciones button {
        font-size: 18px;
        padding: 12px 22px;
      }
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <h2>📦 Registro de Producto</h2>

    <div class="form-section">
      <input type="hidden" id="edit-id" />
      
      <label for="producto">Nombre del Producto:</label>
      <input type="text" id="producto" />

      <label for="palets">Cantidad de Palets:</label>
      <input type="number" id="palets" min="1" />

      <label for="observacion">Observación:</label>
      <textarea id="observacion" rows="3"></textarea>

      <label for="origen">Origen del Palet:</label>
      <select id="origen">
        <option value="">Selecciona origen</option>
        <option value="BARCELONA">BARCELONA</option>
        <option value="ISLA PALMA">ISLA PALMA</option>
        <option value="MENORCA">MENORCA</option>
        <option value="IBIZA">IBIZA</option>
      </select>

      <label for="etiqueta">Etiqueta (Destino):</label>
      <select id="etiqueta">
        <option value="">Selecciona una etiqueta</option>
        <option value="Isla Palma">Isla Palma</option>
        <option value="Menorca">Menorca</option>
        <option value="Ibiza">Ibiza</option>
        <option value="Barcelona">Barcelona</option>
      </select>

      <div id="subetiqueta-container" class="subetiqueta">
        <label for="subetiqueta">Subetiqueta de Isla Palma:</label>
        <select id="subetiqueta">
          <option value="">Selecciona una subetiqueta</option>
          <option value="Roger Palma">Roger Palma</option>
          <option value="Ticsa Palma">Ticsa Palma</option>
          <option value="Solo Isla Palma">Solo Isla Palma</option>
        </select>
      </div>

      <button onclick="guardarProducto()">💾 Guardar Producto</button>
      <button onclick="mostrarProductos()">📅 Ver Productos</button>
    </div>

    <div class="filtros-section">
      <h3>🔎 Filtros de productos</h3>
      <label for="filtro-fecha">Filtrar por Fecha de Ingreso (YYYY-MM-DD):</label>
      <input type="date" id="filtro-fecha" />

      <label for="filtro-origen">Filtrar por Origen:</label>
      <select id="filtro-origen">
        <option value="">Todos</option>
        <option value="BARCELONA">BARCELONA</option>
        <option value="ISLA PALMA">ISLA PALMA</option>
        <option value="MENORCA">MENORCA</option>
        <option value="IBIZA">IBIZA</option>
      </select>

      <label for="filtro-etiqueta">Filtrar por Etiqueta (Destino):</label>
      <select id="filtro-etiqueta">
        <option value="">Todos</option>
        <option value="Isla Palma">Isla Palma</option>
        <option value="Menorca">Menorca</option>
        <option value="Ibiza">Ibiza</option>
        <option value="Barcelona">Barcelona</option>
      </select>

      <label for="filtro-subetiqueta">Filtrar por Subetiqueta Isla Palma:</label>
      <select id="filtro-subetiqueta" style="display:none;">
        <option value="">Todos</option>
        <option value="Roger Palma">Roger Palma</option>
        <option value="Ticsa Palma">Ticsa Palma</option>
        <option value="Solo Isla Palma">Solo Isla Palma</option>
      </select>

      <button onclick="aplicarFiltros()">Aplicar filtros</button>
      <button onclick="limpiarFiltros()">Limpiar filtros</button>
    </div>

    <h3>🧾 Productos</h3>
    <ul id="lista-productos"></ul>
  </div>

  <script>
    const etiquetaSelect = document.getElementById("etiqueta");
    const subetiquetaContainer = document.getElementById("subetiqueta-container");

    etiquetaSelect.addEventListener("change", () => {
      subetiquetaContainer.style.display = etiquetaSelect.value === "Isla Palma" ? "block" : "none";
    });

    const filtroEtiqueta = document.getElementById("filtro-etiqueta");
    const filtroSubetiqueta = document.getElementById("filtro-subetiqueta");

    filtroEtiqueta.addEventListener("change", () => {
      filtroSubetiqueta.style.display = filtroEtiqueta.value === "Isla Palma" ? "block" : "none";
    });

    function obtenerFechaHora() {
      const ahora = new Date();
      const yyyy = ahora.getFullYear();
      const mm = String(ahora.getMonth() + 1).padStart(2, "0");
      const dd = String(ahora.getDate()).padStart(2, "0");
      const hh = String(ahora.getHours()).padStart(2, "0");
      const min = String(ahora.getMinutes()).padStart(2, "0");
      return `${yyyy}-${mm}-${dd} ${hh}:${min}`;
    }

    function guardarProducto() {
      const idEdit = document.getElementById("edit-id").value;
      const producto = document.getElementById("producto").value.trim();
      const palets = document.getElementById("palets").value.trim();
      const observacion = document.getElementById("observacion").value.trim();
      const origen = document.getElementById("origen").value;
      const etiqueta = etiquetaSelect.value;
      const subetiqueta = document.getElementById("subetiqueta").value;
      if (!producto || !palets || !origen || !etiqueta) {
        alert("Por favor completa todos los campos obligatorios (producto, palets, origen y etiqueta).");
        return;
      }

      let productos = JSON.parse(localStorage.getItem("productos") || "[]");

      if (idEdit) {
        // Editar existente
        productos = productos.map(p => {
          if (p.id === idEdit) {
            return {
              id: p.id,
              producto,
              palets,
              observacion,
              origen,
              etiqueta,
              subetiqueta,
              fecha: p.fecha
            };
          }
          return p;
        });
        alert("Producto editado correctamente");
        document.getElementById("edit-id").value = "";
      } else {
        // Nuevo producto
        productos.push({
          id: Date.now().toString(),
          producto,
          palets,
          observacion,
          origen,
          etiqueta,
          subetiqueta,
          fecha: obtenerFechaHora()
        });
        alert("Producto guardado correctamente");
      }

      localStorage.setItem("productos", JSON.stringify(productos));
      limpiarFormulario();
      mostrarProductos();
    }

    function limpiarFormulario() {
      document.getElementById("producto").value = "";
      document.getElementById("palets").value = "";
      document.getElementById("observacion").value = "";
      document.getElementById("origen").value = "";
      etiquetaSelect.value = "";
      document.getElementById("subetiqueta").value = "";
      subetiquetaContainer.style.display = "none";
      document.getElementById("edit-id").value = "";
    }

    function mostrarProductos(productosFiltrados) {
      const lista = document.getElementById("lista-productos");
      let productos = productosFiltrados || JSON.parse(localStorage.getItem("productos") || "[]");

      if (productos.length === 0) {
        lista.innerHTML = "<li>No hay productos registrados.</li>";
        return;
      }

      lista.innerHTML = "";
      productos.forEach(p => {
        const li = document.createElement("li");
        li.classList.add("producto");
        li.innerHTML = `
          <strong>Producto:</strong> ${p.producto} <br/>
          <strong>Palets:</strong> ${p.palets} <br/>
          <strong>Observación:</strong> ${p.observacion || "-"} <br/>
          <strong>Origen del Palet:</strong> ${p.origen} <br/>
          <strong>Etiqueta (Destino):</strong> ${p.etiqueta} <br/>
          <strong>Subetiqueta:</strong> ${p.subetiqueta || "-"} <br/>
          <strong>Fecha Ingreso:</strong> ${p.fecha} <br/>
          <div class="acciones">
            <button class="editar-btn" onclick="editarProducto('${p.id}')">✏️ Editar</button>
            <button onclick="eliminarProducto('${p.id}')">🗑️ Eliminar</button>
          </div>
        `;
        lista.appendChild(li);
      });
    }

    function editarProducto(id) {
      const productos = JSON.parse(localStorage.getItem("productos") || "[]");
      const p = productos.find(prod => prod.id === id);
      if (!p) return;

      document.getElementById("edit-id").value = p.id;
      document.getElementById("producto").value = p.producto;
      document.getElementById("palets").value = p.palets;
      document.getElementById("observacion").value = p.observacion;
      document.getElementById("origen").value = p.origen;
      etiquetaSelect.value = p.etiqueta;
      if (p.etiqueta === "Isla Palma") {
        subetiquetaContainer.style.display = "block";
        document.getElementById("subetiqueta").value = p.subetiqueta;
      } else {
        subetiquetaContainer.style.display = "none";
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function eliminarProducto(id) {
      if (!confirm("¿Estás seguro que deseas eliminar este producto?")) return;
      let productos = JSON.parse(localStorage.getItem("productos") || "[]");
      productos = productos.filter(p => p.id !== id);
      localStorage.setItem("productos", JSON.stringify(productos));
      mostrarProductos();
    }

    // Filtros
    function aplicarFiltros() {
      let productos = JSON.parse(localStorage.getItem("productos") || "[]");
      const filtroFecha = document.getElementById("filtro-fecha").value;
      const filtroOrigen = document.getElementById("filtro-origen").value;
      const filtroEtiqueta = document.getElementById("filtro-etiqueta").value;
      const filtroSubetiqueta = document.getElementById("filtro-subetiqueta").value;

      if (filtroFecha) {
        productos = productos.filter(p => p.fecha.startsWith(filtroFecha));
      }
      if (filtroOrigen) {
        productos = productos.filter(p => p.origen === filtroOrigen);
      }
      if (filtroEtiqueta) {
        productos = productos.filter(p => p.etiqueta === filtroEtiqueta);
      }
      if (filtroEtiqueta === "Isla Palma" && filtroSubetiqueta) {
        productos = productos.filter(p => p.subetiqueta === filtroSubetiqueta);
      }

      mostrarProductos(productos);
    }

    function limpiarFiltros() {
      document.getElementById("filtro-fecha").value = "";
      document.getElementById("filtro-origen").value = "";
      document.getElementById("filtro-etiqueta").value = "";
      document.getElementById("filtro-subetiqueta").value = "";
      document.getElementById("filtro-subetiqueta").style.display = "none";
      mostrarProductos();
    }

    // Mostrar subetiqueta también cuando origen es "ISLA PALMA"
    document.getElementById("origen").addEventListener("change", function() {
      const valor = this.value;
      if (valor === "ISLA PALMA") {
        subetiquetaContainer.style.display = "block";
      } else if (etiquetaSelect.value !== "Isla Palma") {
        // Solo ocultar si etiqueta no es Isla Palma para evitar ocultar si la etiqueta es Isla Palma
        subetiquetaContainer.style.display = "none";
      }
    });

    // Mostrar subetiqueta en filtro también cuando filtro-origen es ISLA PALMA
    document.getElementById("filtro-origen").addEventListener("change", function() {
      const val = this.value;
      if (val === "ISLA PALMA") {
        document.getElementById("filtro-subetiqueta").style.display = "block";
      } else if (filtroEtiqueta.value !== "Isla Palma") {
        document.getElementById("filtro-subetiqueta").style.display = "none";
      }
    });

    // Inicializar lista al cargar
    mostrarProductos();
  </script>
</body>
</html>
